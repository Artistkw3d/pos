<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="POS">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <title>ูุธุงู ููุงุท ุงูุจูุน</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Login -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-logo">๐๏ธ</div>
            <h1 class="login-title">ูุธุงู ููุงุท ุงูุจูุน</h1>
            <form class="login-form" id="loginForm">
                <div class="login-form-group">
                    <label>ุงุณู ุงููุณุชุฎุฏู</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="login-form-group">
                    <label>ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="login-btn">ุฏุฎูู</button>
            </form>
        </div>
    </div>

    <!-- Main -->
    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <div class="header-left">
                <button class="header-btn active" onclick="showTab('pos')" data-tab="pos">๐ณ POS</button>
                <button class="header-btn" onclick="showTab('products')" data-tab="products">๐ฆ ุงูููุชุฌุงุช</button>
                <button class="header-btn" onclick="showTab('inventory')" data-tab="inventory">๐ ุงููุฎุฒูู</button>
                <button class="header-btn" onclick="showTab('invoices')" data-tab="invoices">๐งพ ุงูููุงุชูุฑ</button>
                <button class="header-btn" onclick="showTab('customers')" data-tab="customers">๐ฅ ุงูุนููุงุก</button>
                <button class="header-btn" onclick="showTab('reports')" data-tab="reports">๐ ุงูุชูุงุฑูุฑ</button>
                <button class="header-btn" onclick="showTab('expenses')" data-tab="expenses" id="expensesBtn" style="display: none;">๐ฐ ุงูุชูุงููู</button>
                <button class="header-btn" onclick="showTab('advancedreports')" data-tab="advancedreports" id="advancedReportsBtn" style="display: none;">๐ ุชูุงุฑูุฑ ูุชูุฏูุฉ</button>
                <button class="header-btn" onclick="showTab('systemlogs')" data-tab="systemlogs" id="systemLogsBtn" style="display: none;">๐ ุณุฌู ุงููุธุงู</button>
                <button class="header-btn" onclick="showTab('accounting')" data-tab="accounting">๐ฐ ุงููุญุงุณุจุฉ</button>
                <button class="header-btn" onclick="showTab('dcf')" data-tab="dcf" id="dcfBtn" style="display: none;">๐ ุชูููู DCF</button>
                <button class="header-btn" onclick="showTab('users')" data-tab="users" id="usersBtn" style="display: none;">๐ฅ ุงููุณุชุฎุฏููู</button>
                <button class="header-btn" onclick="showTab('branches')" data-tab="branches" id="branchesBtn" style="display: none;">๐ข ุงููุฑูุน</button>
                <button class="header-btn" onclick="showTab('attendance')" data-tab="attendance">โฐ ุงูุญุถูุฑ</button>
                <button class="header-btn" onclick="showTab('settings')" data-tab="settings" id="settingsBtn" style="display: none;">โ๏ธ ุฅุนุฏุงุฏุงุช</button>
            </div>
            <div class="header-center">
                <h1>๐๏ธ ูุธุงู ููุงุท ุงูุจูุน</h1>
                <div id="datetime" style="font-size: 14px; color: #667eea; margin-top: 5px;"></div>
            </div>
            <div class="header-right">
                <span class="user-info" id="userInfo"></span>
                <button class="logout-btn" id="logoutBtn" onclick="logout()">ุฎุฑูุฌ</button>
            </div>
        </div>

        <!-- POS Tab -->
        <div class="tab-content active" id="posTab">
            <div class="main-content">
                <!-- ุงูููุชุฌุงุช ุนูู ุงููููู -->
                <div class="products-section">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="๐ ุงุจุญุซ..." onkeyup="searchProducts()">
                    </div>
                    <div class="products-grid" id="productsGrid"></div>
                </div>

                <!-- ุงูุณูุฉ ุนูู ุงููุณุงุฑ -->
                <div class="cart-section">
                    <div class="cart-header"><h2>๐ ุงูุณูุฉ</h2><button class="clear-cart-btn" onclick="clearCart()">ูุณุญ</button></div>
                    
                    <!-- ูุงุฆูุฉ ุงูููุชุฌุงุช ุงูุจุณูุทุฉ -->
                    <div class="cart-items" id="cartItems">
                        <div class="empty-cart"><div class="empty-cart-icon">๐</div><p>ุงูุณูุฉ ูุงุฑุบุฉ</p></div>
                    </div>

                    <!-- ูุนูููุงุช ุงูุนููู -->
                    <div class="customer-section">
                        <h3>๐ค ูุนูููุงุช ุงูุนููู</h3>
                        <input type="text" id="customerName" placeholder="ุงูุงุณู">
                        <input type="tel" id="customerPhone" placeholder="ุงููุงุชู">
                        <input type="text" id="customerAddress" placeholder="ุงูุนููุงู">
                    </div>

                    <!-- ุงูุฏูุน -->
                    <div class="payment-section">
                        <h3>๐ณ ุงูุฏูุน</h3>
                        <select id="paymentMethod" onchange="toggleTransactionNumber()">
                            <option value="cash">๐ต ููุฏุงู</option>
                            <option value="knet">๐ณ ูู ูุช</option>
                            <option value="visa">๐ณ ููุฒุง</option>
                            <option value="other">๐ฐ ุฃุฎุฑู</option>
                        </select>
                        <input type="text" id="transactionNumber" placeholder="ุฑูู ุงูุนูููุฉ" style="display: none;">
                    </div>

                    <!-- ุงูููุฎุต -->
                    <div class="invoice-summary">
                        <div class="summary-row"><span>ุงููุฌููุน:</span><span id="subtotal">0.000 ุฏ.ู</span></div>
                        <div class="summary-row">
                            <span>ุงูุฎุตู:</span>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="number" id="discountInput" value="0" min="0" step="0.001" style="width: 80px;" onchange="updateTotals()">
                                <select id="discountType" onchange="updateTotals()" style="width: 70px; padding: 5px;">
                                    <option value="amount">ุฏ.ู</option>
                                    <option value="percent">%</option>
                                </select>
                            </div>
                        </div>
                        <div class="summary-row"><span>ุฑุณูู ุงูุชูุตูู:</span><input type="number" id="deliveryFee" value="0" min="0" step="0.001" style="width: 100px;" onchange="updateTotals()"></div>
                        <div class="summary-row total"><span>ุงูุฅุฌูุงูู:</span><span id="total">0.000 ุฏ.ู</span></div>
                    </div>

                    <!-- ุงูุฒุฑ -->
                    <div class="action-buttons">
                        <button class="complete-btn" onclick="completeSale()">โ ุฅุชูุงู</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div class="tab-content" id="productsTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>๐ฆ ุงูููุชุฌุงุช</h2>
                    <button class="add-btn" onclick="showAddProduct()">โ ุฅุถุงูุฉ</button>
                </div>
                
                <!-- ุจุญุซ ูุชูุฏู -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 15px; font-size: 16px;">๐ ุจุญุซ ูุชูุฏู</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <input type="text" id="searchProductName" placeholder="ุงุณู ุงูููุชุฌ..." onkeyup="advancedSearchProducts()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        <input type="text" id="searchProductBarcode" placeholder="ุงูุจุงุฑููุฏ..." onkeyup="advancedSearchProducts()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        <select id="searchProductCategory" onchange="advancedSearchProducts()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                            <option value="">ูู ุงููุฆุงุช</option>
                        </select>
                        <input type="number" id="searchPriceMin" placeholder="ุงูุณุนุฑ ูู..." onkeyup="advancedSearchProducts()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        <input type="number" id="searchPriceMax" placeholder="ุงูุณุนุฑ ุฅูู..." onkeyup="advancedSearchProducts()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        <button onclick="clearAdvancedSearch()" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">ูุณุญ</button>
                    </div>
                </div>
                
                <div id="productsTableContainer"></div>
            </div>
        </div>

        <!-- Master Inventory Tab -->
        <div class="tab-content" id="inventoryTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center;">
                    <h2>๐ ุงููุฎุฒูู ุงูุฑุฆูุณู</h2>
                    <button class="add-btn" onclick="showAddInventory()">โ ุฅุถุงูุฉ ููุชุฌ</button>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    <strong>๐ก ููู ูุนูู ุงููุธุงู:</strong>
                    <ol style="margin: 10px 0 0 20px;">
                        <li>ุฃุถู ุงูููุชุฌ ููุง ูู <strong>ุงููุฎุฒูู ุงูุฑุฆูุณู</strong></li>
                        <li>ุงุฐูุจ ูุชุจููุจ <strong>ุงูููุชุฌุงุช</strong> ูุชูุฒูุนู ุนูู ุงููุฑูุน</li>
                        <li>ุงูููุชุฌ ุงููุงุญุฏ ูููู ุชูุฒูุนู ุนูู ุนุฏุฉ ูุฑูุน ุจูููุงุช ูุฎุชููุฉ</li>
                    </ol>
                </div>
                
                <div id="inventoryTableContainer"></div>
            </div>
        </div>

        <!-- Products Tab (Branch Distribution) -->
        <div class="tab-content" id="invoicesTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>๐งพ ุงูููุงุชูุฑ</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="exportInvoicesExcel()">๐ ุชุตุฏูุฑ Excel</button>
                        <button class="btn-danger" onclick="clearAllInvoices()" id="clearInvoicesBtn" style="display: none;">๐๏ธ ุญุฐู ุงููู</button>
                    </div>
                </div>
                <div id="invoicesListContainer"></div>
            </div>
        </div>

        <!-- Customers Tab (CRM) -->
        <div class="tab-content" id="customersTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>๐ฅ ุงูุนููุงุก (CRM)</h2>
                    <button onclick="showAddCustomer()" class="add-btn">โ ุฅุถุงูุฉ ุนููู</button>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>ุงูุจุญุซ:</label>
                            <input type="text" id="customerSearch" placeholder="ุงุณูุ ูุงุชูุ ุนููุงู..." onkeyup="searchCustomers()">
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 10px;">
                            <button onclick="loadCustomers()" class="btn">๐ ุนุฑุถ ุงููู</button>
                            <button onclick="exportCustomersExcel()" class="btn" style="background: #38a169;">๐ ุชุตุฏูุฑ</button>
                        </div>
                    </div>
                </div>
                
                <div id="customersContainer"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div class="tab-content" id="reportsTab" style="display: none;">
            <div style="padding: 20px;">
                <h2>๐ ุงูุชูุงุฑูุฑ</h2>
                
                <!-- ููุงุชุฑ ุงูุชูุงุฑูุฑ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="reportStartDate" style="width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ุฅูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="reportEndDate" style="width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ุงููุฑุน:</label>
                            <select id="reportBranch" style="width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px;">
                                <option value="">ูู ุงููุฑูุน</option>
                            </select>
                        </div>
                        <button onclick="loadSalesReport()" class="btn" style="background: #667eea;">๐ ูุจูุนุงุช</button>
                        <button onclick="loadInventoryReport()" class="btn" style="background: #38a169;">๐ฆ ูุฎุฒูู</button>
                        <button onclick="loadDamagedReport()" class="btn" style="background: #e53e3e;">๐ ุชุงูู</button>
                    </div>
                </div>
                
                <!-- ูุชุงุฆุฌ ุงูุชูุงุฑูุฑ -->
                <div id="reportsContent"></div>
            </div>
        </div>

        <!-- System Logs Tab -->
        <div class="tab-content" id="systemlogsTab" style="display: none;">
            <div style="padding: 20px;">
                <h2>๐ ุณุฌู ุงููุธุงู</h2>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <strong>โน๏ธ ููุงุญุธุฉ:</strong> ูุฐุง ุงูุณุฌู ูุชุงุญ ูููุฏูุฑ ููุท ููุนุฑุถ ุฌููุน ุงูุนูููุงุช ูู ุงููุธุงู
                </div>
                <div id="systemLogsContent"></div>
            </div>
        </div>

        <!-- Accounting Tab -->
        <div class="tab-content" id="accountingTab" style="display: none;">
            <div style="padding: 20px;" id="accountingContent"></div>
        </div>

        <!-- DCF Valuation Tab -->
        <div class="tab-content" id="dcfTab" style="display: none;">
            <div style="padding: 20px;">
                <h2>๐ ุชูููู ุงูุดุฑูุฉ - ุงูุชุฏููุงุช ุงูููุฏูุฉ ุงููุฎุตููุฉ (DCF)</h2>
                
                <!-- ููุงุญุธุฉ ุชูุถูุญูุฉ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; color: white; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);">
                    <h3 style="margin-bottom: 10px;">๐ก ููู ุชุณุชุฎุฏู ูุฐู ุงูุฃุฏุงุฉ:</h3>
                    <ol style="margin: 10px 0; padding-right: 25px; line-height: 1.8;">
                        <li>ุฃุฏุฎู ุงูุจูุงูุงุช ุงููุงููุฉ ููุดุฑูุฉ ูู ุงูุญููู ุฃุฏูุงู</li>
                        <li>ุงุถุบุท ุนูู ุฒุฑ "๐งฎ ุงุญุณุจ ุงูุชูููู"</li>
                        <li>ุณุชุธูุฑ ุงููุชุงุฆุฌ ูุน ุฌุฏูู ุชูุตููู ูุฑุณู ุจูุงูู</li>
                    </ol>
                    <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                        <strong>ููุงุญุธุฉ:</strong> DCF ูู ุฃุฏุงุฉ ูุชูููู ูููุฉ ุงูุดุฑูุฉ ุจูุงุกู ุนูู ุงูุชุฏููุงุช ุงูููุฏูุฉ ุงููุณุชูุจููุฉ ุงููุชููุนุฉ.
                    </p>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #667eea;">๐ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>ุงูุชุฏูู ุงูููุฏู ุงูุญุงูู (ุงูุณูุฉ 0):</label>
                            <input type="number" id="dcf_initial_cf" step="0.01" value="100000" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </div>
                        
                        <div class="form-group">
                            <label>ูุนุฏู ุงูููู ุงููุชููุน (%):</label>
                            <input type="number" id="dcf_growth_rate" step="0.1" value="5" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </div>
                        
                        <div class="form-group">
                            <label>ูุนุฏู ุงูุฎุตู (WACC) (%):</label>
                            <input type="number" id="dcf_discount_rate" step="0.1" value="10" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </div>
                        
                        <div class="form-group">
                            <label>ุนุฏุฏ ุงูุณููุงุช:</label>
                            <input type="number" id="dcf_years" min="1" max="20" value="5" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </div>
                        
                        <div class="form-group">
                            <label>ูุนุฏู ุงูููู ุงูุฏุงุฆู (Terminal Growth) (%):</label>
                            <input type="number" id="dcf_terminal_growth" step="0.1" value="2" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </div>
                    </div>
                    
                    <button onclick="calculateDCF()" class="btn" style="width: 100%; padding: 12px; font-size: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">๐งฎ ุงุญุณุจ ุงูุชูููู</button>
                </div>
                
                <!-- ุงููุชุงุฆุฌ -->
                <div id="dcfResults" style="display: none;">
                    <!-- ููุฎุต -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; color: white; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        <h3 style="margin-bottom: 15px;">๐ ูููุฉ ุงูุดุฑูุฉ ุงูููุฏุฑุฉ</h3>
                        <div style="font-size: 42px; font-weight: bold; margin: 20px 0;" id="dcfTotalValue">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">ุงููููุฉ ุงูุญุงููุฉ ููุชุฏููุงุช ุงูููุฏูุฉ ุงููุณุชูุจููุฉ</div>
                    </div>
                    
                    <!-- ุงูุชูุงุตูู -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h4 style="color: #667eea; margin-bottom: 15px;">๐ ุงูุชุฏููุงุช ุงููุฎุตููุฉ</h4>
                            <div style="font-size: 28px; font-weight: bold; color: #2d3748;" id="dcfPVCashFlows">0</div>
                            <div style="font-size: 12px; color: #718096; margin-top: 5px;">ุงููููุฉ ุงูุญุงููุฉ ููุชุฏููุงุช (ุงูุณููุงุช 1-N)</div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h4 style="color: #667eea; margin-bottom: 15px;">โพ๏ธ ุงููููุฉ ุงููุชุจููุฉ</h4>
                            <div style="font-size: 28px; font-weight: bold; color: #2d3748;" id="dcfTerminalValue">0</div>
                            <div style="font-size: 12px; color: #718096; margin-top: 5px;">ุงููููุฉ ุงูุญุงููุฉ ููุชุฏููุงุช ุงูุฏุงุฆูุฉ</div>
                        </div>
                    </div>
                    
                    <!-- ุฌุฏูู ุงูุชูุงุตูู -->
                    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4 style="color: #667eea; margin-bottom: 20px;">๐ ุชูุงุตูู ุงูุชุฏููุงุช ุงูุณูููุฉ</h4>
                        <div id="dcfTable" style="overflow-x: auto;"></div>
                    </div>
                    
                    <!-- ุงูุฑุณู ุงูุจูุงูู -->
                    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 20px;">
                        <h4 style="color: #667eea; margin-bottom: 20px;">๐ ุชุตูุฑ ุงูุชุฏููุงุช ุงูููุฏูุฉ</h4>
                        <canvas id="dcfChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div class="tab-content" id="usersTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>๐ฅ ุงููุณุชุฎุฏููู</h2>
                    <button class="add-btn" onclick="showAddUser()">โ ุฅุถุงูุฉ</button>
                </div>
                <div id="usersTableContainer"></div>
            </div>
        </div>

        <!-- Branches Tab -->
        <div class="tab-content" id="branchesTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2>๐ข ุฅุฏุงุฑุฉ ุงููุฑูุน</h2>
                    <button class="add-btn" onclick="showAddBranch()">โ ุฅุถุงูุฉ ูุฑุน</button>
                </div>
                <div id="branchesTableContainer"></div>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div class="tab-content" id="attendanceTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>โฐ ุณุฌู ุงูุญุถูุฑ ูุงูุงูุตุฑุงู</h2>
                    <button class="btn" onclick="checkOut()" style="background: #e53e3e; font-size: 16px;">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 10px;">๐ ููุชุฑุฉ ุงูุณุฌู</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <select id="filterAttendanceUser" onchange="loadAttendanceLog()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                            <option value="">ูู ุงูููุธููู</option>
                        </select>
                        <input type="date" id="filterAttendanceDate" onchange="loadAttendanceLog()" style="padding: 8px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        <button onclick="clearAttendanceFilters()" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">ูุณุญ ุงูููุงุชุฑ</button>
                    </div>
                </div>
                
                <div id="attendanceTableContainer"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settingsTab" style="display: none;">
            <div style="padding: 20px;">
                <h2>โ๏ธ ุงูุฅุนุฏุงุฏุงุช</h2>
                <div style="max-width: 600px;">
                    <div class="form-group"><label>ุงุณู ุงููุชุฌุฑ:</label><input type="text" id="storeName"></div>
                    <div class="form-group"><label>ุฑูู ุงููุงุชู:</label><input type="tel" id="storePhone"></div>
                    <div class="form-group"><label>ุงูุนููุงู:</label><input type="text" id="storeAddress"></div>
                    
                    <!-- ุงูุนููุฉ -->
                    <div class="form-group">
                        <label>ุงูุนููุฉ:</label>
                        <select id="storeCurrency" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                            <option value="KWD">๐ฐ๐ผ ุฏููุงุฑ ูููุชู (KWD)</option>
                            <option value="USD">๐บ๐ธ ุฏููุงุฑ ุฃูุฑููู (USD)</option>
                            <option value="EUR">๐ช๐บ ููุฑู (EUR)</option>
                            <option value="GBP">๐ฌ๐ง ุฌููู ุฅุณุชุฑูููู (GBP)</option>
                            <option value="SAR">๐ธ๐ฆ ุฑูุงู ุณุนูุฏู (SAR)</option>
                            <option value="AED">๐ฆ๐ช ุฏุฑูู ุฅูุงุฑุงุชู (AED)</option>
                            <option value="QAR">๐ถ๐ฆ ุฑูุงู ูุทุฑู (QAR)</option>
                            <option value="OMR">๐ด๐ฒ ุฑูุงู ุนูุงูู (OMR)</option>
                            <option value="BHD">๐ง๐ญ ุฏููุงุฑ ุจุญุฑููู (BHD)</option>
                            <option value="EGP">๐ช๐ฌ ุฌููู ูุตุฑู (EGP)</option>
                            <option value="JOD">๐ฏ๐ด ุฏููุงุฑ ุฃุฑุฏูู (JOD)</option>
                            <option value="IQD">๐ฎ๐ถ ุฏููุงุฑ ุนุฑุงูู (IQD)</option>
                            <option value="LBP">๐ฑ๐ง ููุฑุฉ ูุจูุงููุฉ (LBP)</option>
                            <option value="TRY">๐น๐ท ููุฑุฉ ุชุฑููุฉ (TRY)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ุดุนุงุฑ ุงููุชุฌุฑ (ูู ุงูููุงุชูุฑ):</label>
                        <input type="file" id="storeLogo" accept="image/*" onchange="previewLogo(this)">
                        <div id="logoPreview" style="margin-top: 10px; display: none;">
                            <img id="logoPreviewImg" style="max-width: 200px; max-height: 100px; border-radius: 8px;">
                            <button onclick="removeLogo()" class="btn-danger" style="margin-top: 10px;">ุญุฐู ุงูุดุนุงุฑ</button>
                        </div>
                    </div>
                    
                    <!-- ุฃููููุฉ ุดุงุดุฉ ุงูุฏุฎูู -->
                    <div class="form-group">
                        <label>ุฃููููุฉ ุดุงุดุฉ ุงูุฏุฎูู:</label>
                        <input type="file" id="loginIcon" accept="image/*" onchange="previewLoginIcon(this)">
                        <div id="loginIconPreview" style="margin-top: 10px; display: none;">
                            <img id="loginIconPreviewImg" style="max-width: 150px; max-height: 150px; border-radius: 50%; border: 4px solid #667eea;">
                            <button onclick="removeLoginIcon()" class="btn-danger" style="margin-top: 10px;">ุงุณุชุนุงุฏุฉ ุงูุฃููููุฉ ุงูุงูุชุฑุงุถูุฉ</button>
                        </div>
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">* ุงูุฃููููุฉ ุงูุงูุชุฑุงุถูุฉ: ๐๏ธ</p>
                    </div>
                    
                    <button onclick="saveSettings()" class="btn">ุญูุธ</button>
                </div>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div class="tab-content" id="expensesTab" style="display: none;">
            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>๐ฐ ุงูุชูุงููู</h2>
                    <button onclick="showAddExpense()" class="add-btn">โ ุฅุถุงูุฉ ุชูููุฉ</button>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>ูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="expenseStartDate">
                        </div>
                        <div class="form-group">
                            <label>ุฅูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="expenseEndDate">
                        </div>
                        <div class="form-group">
                            <label>ุงููุฑุน:</label>
                            <select id="expenseBranchFilter">
                                <option value="">ูู ุงููุฑูุน</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button onclick="loadExpenses()" class="btn">ุนุฑุถ</button>
                        </div>
                    </div>
                </div>
                
                <div id="expensesContainer"></div>
            </div>
        </div>

        <!-- Advanced Reports Tab -->
        <div class="tab-content" id="advancedreportsTab" style="display: none;">
            <div style="padding: 20px;">
                <h2>๐ ุงูุชูุงุฑูุฑ ุงููุชูุฏูุฉ</h2>
                
                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>ูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="advReportStartDate">
                        </div>
                        <div class="form-group">
                            <label>ุฅูู ุชุงุฑูุฎ:</label>
                            <input type="date" id="advReportEndDate">
                        </div>
                        <div class="form-group">
                            <label>ุงููุฑุน:</label>
                            <select id="advReportBranchFilter">
                                <option value="">ูู ุงููุฑูุน</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                    <button onclick="loadProductReport()" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); flex: 1; min-width: 200px; padding: 15px;">๐ฆ ุงููุจูุนุงุช ุญุณุจ ุงูููุชุฌ</button>
                    <button onclick="loadBranchReport()" class="btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); flex: 1; min-width: 200px; padding: 15px;">๐ข ุงููุจูุนุงุช ุญุณุจ ุงููุฑุน</button>
                    <button onclick="loadProfitLossReport()" class="btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); flex: 1; min-width: 200px; padding: 15px;">๐ฐ ุงูุฑุจุญ ูุงูุฎุณุงุฑุฉ</button>
                </div>
                
                <div id="advancedReportContent"></div>
            </div>
        </div>
    </div>

    <!-- Add Inventory Modal -->
    <div class="modal" id="addInventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="inventoryModalTitle">โ ุฅุถุงูุฉ ููุชุฌ ูููุฎุฒูู</h2>
                <button class="close-btn" onclick="closeAddInventory()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="inventoryForm">
                    <input type="hidden" id="inventoryId">
                    <div class="form-group"><label>ุงุณู ุงูููุชุฌ:</label><input type="text" id="inventoryName" required></div>
                    <div class="form-group"><label>ุงูุจุงุฑููุฏ:</label><input type="text" id="inventoryBarcode"></div>
                    <div class="form-group"><label>ุงูุณุนุฑ (ุฏ.ู):</label><input type="number" id="inventoryPrice" step="0.001" required></div>
                    <div class="form-group"><label>ุงูุชูููุฉ (ุฏ.ู):</label><input type="number" id="inventoryCost" step="0.001"></div>
                    <div class="form-group">
                        <label>ุงููุฆุฉ:</label>
                        <select id="inventoryCategory">
                            <option value="">-- ุงุฎุชุฑ ูุฆุฉ --</option>
                        </select>
                        <input type="text" id="inventoryNewCategory" placeholder="ุฃู ุฃุถู ูุฆุฉ ุฌุฏูุฏุฉ" style="margin-top: 5px;">
                    </div>
                    <div class="form-group">
                        <label>ุตูุฑุฉ ุงูููุชุฌ:</label>
                        <input type="file" id="inventoryImageInput" accept="image/*" style="display: none;" onchange="handleInventoryImage(this)">
                        <button type="button" onclick="document.getElementById('inventoryImageInput').click()" class="btn" style="background: #38a169;">๐ท ุฑูุน ุตูุฑุฉ</button>
                        <input type="hidden" id="inventoryImageData">
                        <div id="inventoryImagePreview" style="margin-top: 10px; display: none; text-align: center; padding: 15px; border: 2px solid #cbd5e0; border-radius: 8px; background: #f8f9fa;">
                            <div id="inventoryImageDisplay" style="margin: 10px 0;"></div>
                            <button type="button" onclick="removeInventoryImage()" class="btn-danger">๐๏ธ ุญุฐู ุงูุตูุฑุฉ</button>
                        </div>
                    </div>
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Distribution Modal -->
    <div class="modal" id="distributionModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="distributionModalTitle">๐ค ุชูุฒูุน ุงูููุชุฌ ุนูู ุงููุฑูุน</h2>
                <button class="close-btn" onclick="closeDistribution()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <div id="distributionProductInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
                
                <h3>ุงูุชูุฒูุนุงุช ุงูุญุงููุฉ:</h3>
                <div id="currentDistributions" style="margin-bottom: 20px;"></div>
                
                <h3>ุฅุถุงูุฉ ุชูุฒูุน ุฌุฏูุฏ:</h3>
                <form id="distributionForm" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                    <div>
                        <label>ุงููุฑุน:</label>
                        <select id="distributionBranch" required style="width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px;">
                        </select>
                    </div>
                    <div>
                        <label>ุงููููุฉ:</label>
                        <input type="number" id="distributionStock" required min="1" style="width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px;">
                    </div>
                    <button type="submit" class="btn" style="background: #38a169;">โ ุฅุถุงูุฉ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Damage Report Modal -->
    <div class="modal" id="damageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>๐ ุชุณุฌูู ุชุงูู</h2>
                <button class="close-btn" onclick="closeDamageModal()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <div id="damageProductInfo" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
                <form id="damageForm">
                    <input type="hidden" id="damageInventoryId">
                    <div class="form-group">
                        <label>ุงููุฑุน:</label>
                        <select id="damageBranch" required onchange="updateDamageStock()" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงููุฎุฒูู ุงููุชุงุญ:</label>
                        <div id="availableStock" style="font-size: 18px; font-weight: bold; color: #38a169; padding: 10px; background: #f0fff4; border-radius: 5px;">-</div>
                    </div>
                    <div class="form-group">
                        <label>ุงููููุฉ ุงูุชุงููุฉ:</label>
                        <input type="number" id="damageQuantity" required min="1" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%;">
                    </div>
                    <div class="form-group">
                        <label>ุงูุณุจุจ:</label>
                        <textarea id="damageReason" rows="3" style="padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; width: 100%; resize: vertical;" placeholder="ูุซุงู: ุงููุณุฑุ ููุชูู ุงูุตูุงุญูุฉุ ุชูู ุฃุซูุงุก ุงูููู..."></textarea>
                    </div>
                    <button type="submit" class="btn" style="background: #e53e3e;">๐ ุชุณุฌูู ุงูุชุงูู</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">โ ุฅุถุงูุฉ ููุชุฌ</h2>
                <button class="close-btn" onclick="closeAddProduct()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    <div class="form-group"><label>ุงุณู ุงูููุชุฌ:</label><input type="text" id="productName" required></div>
                    <div class="form-group"><label>ุงูุจุงุฑููุฏ:</label><input type="text" id="productBarcode"></div>
                    <div class="form-group"><label>ุงูุณุนุฑ (ุฏ.ู):</label><input type="number" id="productPrice" step="0.001" required></div>
                    <div class="form-group"><label>ุงูุชูููุฉ (ุฏ.ู):</label><input type="number" id="productCost" step="0.001"></div>
                    <div class="form-group"><label>ุงููุฎุฒูู:</label><input type="number" id="productStock" value="0"></div>
                    <div class="form-group">
                        <label>ุงููุฆุฉ:</label>
                        <select id="productCategory">
                            <option value="">-- ุงุฎุชุฑ ูุฆุฉ --</option>
                        </select>
                        <input type="text" id="newCategory" placeholder="ุฃู ุฃุถู ูุฆุฉ ุฌุฏูุฏุฉ" style="margin-top: 5px;">
                    </div>
                    <div class="form-group" id="productBranchField">
                        <label>ุงููุฑุน:</label>
                        <select id="productBranch">
                            <option value="1">ุงููุฑุน ุงูุฑุฆูุณู</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุตูุฑุฉ ุงูููุชุฌ:</label>
                        <input type="file" id="productImageInput" accept="image/*" style="display: none;" onchange="handleProductImage(this)">
                        <button type="button" onclick="document.getElementById('productImageInput').click()" class="btn" style="background: #38a169;">๐ท ุฑูุน ุตูุฑุฉ</button>
                        <input type="hidden" id="productImageData">
                        <div id="productImagePreview" style="margin-top: 10px; display: none; text-align: center; padding: 15px; border: 2px solid #cbd5e0; border-radius: 8px; background: #f8f9fa;">
                            <div id="productImageDisplay" style="margin: 10px 0;"></div>
                            <button type="button" onclick="removeProductImage()" class="btn-danger">๐๏ธ ุญุฐู ุงูุตูุฑุฉ</button>
                        </div>
                    </div>
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle">โ ุฅุถุงูุฉ ูุณุชุฎุฏู</h2>
                <button class="close-btn" onclick="closeAddUser()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    <div class="form-group"><label>ุงุณู ุงููุณุชุฎุฏู:</label><input type="text" id="username" required></div>
                    <div class="form-group"><label>ูููุฉ ุงููุฑูุฑ:</label><input type="password" id="userPassword" required></div>
                    <div class="form-group"><label>ุงูุงุณู ุงููุงูู:</label><input type="text" id="fullName" required></div>
                    <div class="form-group">
                        <label>ุงูุตูุงุญูุฉ:</label>
                        <select id="userRole">
                            <option value="cashier">ูุงุดูุฑ</option>
                            <option value="admin">ูุฏูุฑ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงููุฑุน:</label>
                        <select id="userBranch">
                            <option value="1">ุงููุฑุน ุงูุฑุฆูุณู</option>
                        </select>
                    </div>
                    <div class="form-group"><label>ุจุงุฏุฆุฉ ุงููุงุชูุฑุฉ:</label><input type="text" id="invoicePrefix" maxlength="10" placeholder="AHM, S1"></div>
                    
                    <div class="form-group" id="permissionsSection" style="display: none;">
                        <label style="font-weight: bold; font-size: 16px; margin-bottom: 10px; display: block; color: #667eea;">๐ ุงูุตูุงุญูุงุช ุงูุชูุตูููุฉ</label>
                        <div style="border: 2px solid #e2e8f0; padding: 15px; border-radius: 8px; background: #f8f9fa;">
                            
                            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #cbd5e0;">
                                <strong style="color: #667eea; font-size: 14px;">๐ฆ ุงูููุชุฌุงุช</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_products" style="width: 18px; height: 18px;" checked>
                                        <span>๐๏ธ ุนุฑุถ ุงูููุชุฌุงุช</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_add_products" style="width: 18px; height: 18px;">
                                        <span>โ ุฅุถุงูุฉ ููุชุฌุงุช</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_edit_products" style="width: 18px; height: 18px;">
                                        <span>โ๏ธ ุชุนุฏูู ููุชุฌุงุช</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_delete_products" style="width: 18px; height: 18px;">
                                        <span>๐๏ธ ุญุฐู ููุชุฌุงุช</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #cbd5e0;">
                                <strong style="color: #667eea; font-size: 14px;">๐ ุงููุฎุฒูู</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_inventory" style="width: 18px; height: 18px;">
                                        <span>๐๏ธ ุนุฑุถ ุงููุฎุฒูู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_add_inventory" style="width: 18px; height: 18px;">
                                        <span>โ ุฅุถุงูุฉ ูููุฎุฒูู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_edit_inventory" style="width: 18px; height: 18px;">
                                        <span>โ๏ธ ุชุนุฏูู ุงููุฎุฒูู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_delete_inventory" style="width: 18px; height: 18px;">
                                        <span>๐๏ธ ุญุฐู ูู ุงููุฎุฒูู</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #cbd5e0;">
                                <strong style="color: #667eea; font-size: 14px;">๐งพ ุงูููุงุชูุฑ</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_invoices" style="width: 18px; height: 18px;" checked>
                                        <span>๐๏ธ ุนุฑุถ ูู ุงูููุงุชูุฑ</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_delete_invoices" style="width: 18px; height: 18px;">
                                        <span>๐๏ธ ุญุฐู ุงูููุงุชูุฑ</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #cbd5e0;">
                                <strong style="color: #667eea; font-size: 14px;">๐ฅ ุงูุนููุงุก (CRM)</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_customers" style="width: 18px; height: 18px;" checked>
                                        <span>๐๏ธ ุนุฑุถ ุงูุนููุงุก</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_add_customer" style="width: 18px; height: 18px;">
                                        <span>โ ุฅุถุงูุฉ ุนููู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_edit_customer" style="width: 18px; height: 18px;">
                                        <span>โ๏ธ ุชุนุฏูู ุนููู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_delete_customer" style="width: 18px; height: 18px;">
                                        <span>๐๏ธ ุญุฐู ุนููู</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #cbd5e0;">
                                <strong style="color: #667eea; font-size: 14px;">๐ ุงูุชูุงุฑูุฑ ูุงููุญุงุณุจุฉ</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_reports" style="width: 18px; height: 18px;">
                                        <span>๐ ุนุฑุถ ุงูุชูุงุฑูุฑ</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_view_accounting" style="width: 18px; height: 18px;">
                                        <span>๐ฐ ุนุฑุถ ุงููุญุงุณุจุฉ</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #667eea; font-size: 14px;">โ๏ธ ุงูุฅุฏุงุฑุฉ</strong>
                                <div style="margin: 10px 0 5px 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_manage_users" style="width: 18px; height: 18px;">
                                        <span>๐ฅ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 5px 0;">
                                        <input type="checkbox" name="can_access_settings" style="width: 18px; height: 18px;">
                                        <span>โ๏ธ ุงููุตูู ููุฅุนุฏุงุฏุงุช</span>
                                    </label>
                                </div>
                            </div>
                            
                            <p style="font-size: 12px; color: #6c757d; margin: 15px 0 0; padding-top: 10px; border-top: 1px solid #cbd5e0;">
                                ๐ก <strong>ููุงุญุธุฉ:</strong> ุงููุฏูุฑ ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช ุชููุงุฆูุงู ููุง ูุญุชุงุฌ ูุชุญุฏูุฏูุง
                            </p>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Branch Modal -->
    <div class="modal" id="addBranchModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="branchModalTitle">โ ุฅุถุงูุฉ ูุฑุน</h2>
                <button class="close-btn" onclick="closeAddBranch()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="branchForm">
                    <input type="hidden" id="branchId">
                    <div class="form-group"><label>ุงุณู ุงููุฑุน:</label><input type="text" id="branchName" required></div>
                    <div class="form-group"><label>ุงููููุน:</label><input type="text" id="branchLocation"></div>
                    <div class="form-group"><label>ุฑูู ุงููุงุชู:</label><input type="tel" id="branchPhone"></div>
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Invoice View Modal -->
    <div class="modal" id="invoiceViewModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>๐งพ ุงููุงุชูุฑุฉ</h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="printInvoiceFromView()" class="btn">๐จ๏ธ ุทุจุงุนุฉ</button>
                    <button class="close-btn" onclick="closeInvoiceView()">โ๏ธ</button>
                </div>
            </div>
            <div class="modal-body" id="invoiceViewContent"></div>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal" id="addExpenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="expenseModalTitle">โ ุฅุถุงูุฉ ุชูููุฉ</h2>
                <button class="close-btn" onclick="closeAddExpense()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-group">
                        <label>ููุน ุงูุชูููุฉ:</label>
                        <select id="expenseType" required>
                            <option value="">ุงุฎุชุฑ ุงูููุน</option>
                            <option value="ุฅูุฌุงุฑ">๐ข ุฅูุฌุงุฑ ุงููุญู</option>
                            <option value="ุฑูุงุชุจ">๐ฐ ุฑูุงุชุจ ุงูููุธููู</option>
                            <option value="ููุฑุจุงุก ููุงุก">โก ููุฑุจุงุก ููุงุก</option>
                            <option value="ุฅูุชุฑูุช ูุงุชุตุงูุงุช">๐ฑ ุฅูุชุฑูุช ูุงุชุตุงูุงุช</option>
                            <option value="ูุตุงุฑูู ุชูุตูู">๐ ูุตุงุฑูู ุชูุตูู</option>
                            <option value="ุตูุงูุฉ">๐๏ธ ุตูุงูุฉ</option>
                            <option value="ูุตุงุฑูู ุฅุฏุงุฑูุฉ">๐ ูุตุงุฑูู ุฅุฏุงุฑูุฉ</option>
                            <option value="ุชุนุจุฆุฉ ูุชุบููู">๐ฆ ุชุนุจุฆุฉ ูุชุบููู</option>
                            <option value="ุชุณููู ูุฅุนูุงูุงุช">๐ข ุชุณููู ูุฅุนูุงูุงุช</option>
                            <option value="ุฃุฎุฑู">๐ง ุฃุฎุฑู</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงููุจูุบ (ุฏ.ู):</label>
                        <input type="number" id="expenseAmount" step="0.001" required>
                    </div>
                    <div class="form-group">
                        <label>ุงูุชุงุฑูุฎ:</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label>ุงููุฑุน:</label>
                        <select id="expenseBranch">
                            <option value="">ุงุฎุชุฑ ุงููุฑุน</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงููุตู:</label>
                        <textarea id="expenseDescription" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="customerModalTitle">โ ุฅุถุงูุฉ ุนููู</h2>
                <button class="close-btn" onclick="closeAddCustomer()">โ๏ธ</button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <input type="hidden" id="customerId">
                    <div class="form-group">
                        <label>ุงูุงุณู:</label>
                        <input type="text" id="customerNameField" required>
                    </div>
                    <div class="form-group">
                        <label>ุฑูู ุงููุงุชู:</label>
                        <input type="tel" id="customerPhoneField">
                    </div>
                    <div class="form-group">
                        <label>ุงูุนููุงู:</label>
                        <textarea id="customerAddressField" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ููุงุญุธุงุช:</label>
                        <textarea id="customerNotes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn">ุญูุธ</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
    // ุฅุธูุงุฑ/ุฅุฎูุงุก ูุณู ุงูุตูุงุญูุงุช ุญุณุจ ุงูุฏูุฑ
    document.addEventListener('DOMContentLoaded', function() {
        const roleSelect = document.getElementById('userRole');
        const permSection = document.getElementById('permissionsSection');
        
        if (roleSelect && permSection) {
            roleSelect.addEventListener('change', function() {
                if (this.value === 'cashier') {
                    permSection.style.display = 'block';
                } else {
                    permSection.style.display = 'none';
                }
            });
        }
    });
    </script>
    
    <!-- PWA Scripts -->
    <script src="localdb.js"></script>
    <script src="sync-manager.js"></script>
    <script>
    // ========================================
    // PWA Initialization
    // ========================================
    
    // ุชุณุฌูู Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => {
                    console.log('[PWA] Service Worker registered โ');
                })
                .catch(err => {
                    console.error('[PWA] Service Worker registration failed:', err);
                });
        });
    }
    
    // ุชููุฆุฉ IndexedDB
    window.addEventListener('load', async () => {
        try {
            await localDB.init();
            console.log('[PWA] LocalDB initialized โ');
            
            // ุชุญููู ุฃููููุฉ Login ูู ุงูุฅุนุฏุงุฏุงุช (ูุจู ุชุณุฌูู ุงูุฏุฎูู)
            try {
                const response = await fetch(`${API_URL}/api/settings`);
                const data = await response.json();
                if (data.success && data.settings.login_icon) {
                    document.querySelector('.login-logo').innerHTML = `<img src="${data.settings.login_icon}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">`;
                    console.log('[App] Login icon loaded โ');
                }
            } catch (e) {
                console.log('[App] Using default login icon');
            }
            
            // ุชุญููู ุงูููุชุฌุงุช ุงููุญููุฉ ุฅุฐุง offline
            if (!navigator.onLine) {
                const localProducts = await localDB.getAll('products');
                if (localProducts.length > 0) {
                    console.log('[PWA] Loaded from local cache');
                }
            }
            
            // ุจุฏุก ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
            if (navigator.onLine) {
                setTimeout(() => syncManager.sync(), 2000);
                syncManager.start(5); // ูู 5 ุฏูุงุฆู
            }
            
            // ุชุญุฏูุซ ุญุงูุฉ ุฒุฑ ุงูุฎุฑูุฌ ุญุณุจ ุงูุงุชุตุงู
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                if (!navigator.onLine) {
                    logoutBtn.disabled = true;
                    logoutBtn.style.opacity = '0.5';
                    logoutBtn.style.cursor = 'not-allowed';
                    logoutBtn.title = 'ูุง ูููู ุชุณุฌูู ุงูุฎุฑูุฌ ูู ูุถุน offline';
                }
            }
            
        } catch (error) {
            console.error('[PWA] Initialization error:', error);
        }
    });
    
    // ูุฑุงูุจุฉ ุญุงูุฉ ุงูุงุชุตุงู
    window.addEventListener('online', () => {
        console.log('[PWA] Online โ');
        syncManager.showStatus('๐ ูุชุตู - ุฌุงุฑู ุงููุฒุงููุฉ...', 'info');
        setTimeout(() => syncManager.sync(), 1000);
        
        // ุชูุนูู ุฒุฑ ุงูุฎุฑูุฌ
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.disabled = false;
            logoutBtn.style.opacity = '1';
            logoutBtn.style.cursor = 'pointer';
            logoutBtn.title = '';
        }
    });
    
    window.addEventListener('offline', () => {
        console.log('[PWA] Offline ๐ด');
        syncManager.showStatus('๐ด ุบูุฑ ูุชุตู - ุงููุถุน ุงููุญูู', 'info');
        
        // ุชุนุทูู ุฒุฑ ุงูุฎุฑูุฌ
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.disabled = true;
            logoutBtn.style.opacity = '0.5';
            logoutBtn.style.cursor = 'not-allowed';
            logoutBtn.title = 'ูุง ูููู ุชุณุฌูู ุงูุฎุฑูุฌ ูู ูุถุน offline';
        }
    });
    </script>
    
    <script src="app.js"></script>
    <script src="products-search.js"></script>
</body>
</html>
